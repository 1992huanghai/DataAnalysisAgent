<!DOCTYPE html>
<html>
<head>
    <title>国家用户分布饼图</title>
    <!-- 引入ECharts库 -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.1/dist/echarts.min.js"></script>
    <style>
        /* 设置图表容器样式 */
        #chart-container {
            width: 800px;
            height: 600px;
            margin: 50px auto;
            background-color: #f5f5f5;
            border-radius: 8px;
            padding: 20px;
        }
    </style>
</head>
<body>
    <!-- 图表容器 -->
    <div id="chart-container"></div>

    <script>
        // 初始化图表
        var myChart = echarts.init(document.getElementById('chart-container'));

        // 处理数据
        const data = [
            [
                "df_0",
                {
                    "国家": [
                        NaN,
                        "AE",
                        "AT",
                        "AU",
                        "CA"
                    ],
                    "用户数": [
                        1,
                        4,
                        5,
                        15,
                        1
                    ]
                }
            ]
        ];

        // 提取国家和用户数数据
        const processedData = data[0][1];
        const countries = processedData.国家.filter((item, index) => {
            return !isNaN(item); // 过滤掉NaN值
        });
        const userCounts = processedData.用户数.filter((item, index) => {
            return !isNaN(processedData.国家[index]); // 保持与国家数据一致
        });

        // 计算总用户数
        const totalUsers = userCounts.reduce((sum, current) => sum + current, 0);

        // 准备图表数据
        const chartData = countries.map((country, index) => {
            return {
                name: country,
                value: userCounts[index],
                percent: (userCounts[index] / totalUsers * 100).toFixed(1) + '%'
            };
        });

        // 配置图表
        const option = {
            title: {
                text: '国家用户分布',
                left: 'center',
                top: '10%',
                textStyle: {
                    fontSize: 20
                }
            },
            tooltip: {
                trigger: 'item',
                formatter: '{a} <br/>{b}: {c} ({d}%)'
            },
            legend: {
                type: 'scroll',
                orient: 'vertical',
                right: '10%',
                top: '20%',
                bottom: '20%',
                formatter: function(name) {
                    const item = chartData.find(item => item.name === name);
                    return `${name}: ${item.value} (${item.percent})`;
                }
            },
            series: [
                {
                    name: '用户数',
                    type: 'pie',
                    radius: ['30%', '70%'],
                    center: ['40%', '50%'],
                    data: chartData,
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }
            ]
        };

        // 渲染图表
        myChart.setOption(option);

        // 自适应窗口大小
        window.addEventListener('resize', function () {
            myChart.resize();
        });
    </script>
</body>
</html>